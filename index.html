<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioBricks Catch Game - iGEM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }
        #canvas-container {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <script>
        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†
        let score = 0;               // ç¾åœ¨ã®ã‚¹ã‚³ã‚¢
        let gameTime = 60;           // ã‚²ãƒ¼ãƒ ã®åˆ¶é™æ™‚é–“ï¼ˆç§’ï¼‰
        let timeLeft = gameTime;     // æ®‹ã‚Šæ™‚é–“
        let startTime;               // ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚åˆ»
        let gameOver = false;        // ã‚²ãƒ¼ãƒ çµ‚äº†ãƒ•ãƒ©ã‚°
        let rankingSaved = false;    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜æ¸ˆã¿ãƒ•ãƒ©ã‚°
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
        let rankings = [];           // ãƒˆãƒƒãƒ—3ã®ã‚¹ã‚³ã‚¢ã‚’ä¿å­˜
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚·ãƒ£ãƒ¼ãƒ¬ï¼‰
        let player;
        
        // è½ã¡ã¦ãã‚‹ãƒ‘ãƒ¼ãƒ„ã®é…åˆ—
        let fallingParts = [];
        let spawnInterval = 60;      // ãƒ‘ãƒ¼ãƒ„ã®å‡ºç¾é–“éš”ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ æ•°ï¼‰
        let frameCounter = 0;
        
        // ã‚³ãƒ³ãƒœã‚·ã‚¹ãƒ†ãƒ 
        let comboSequence = ['P', 'R', 'G', 'T'];  // æ­£ã—ã„é †ç•ª
        let currentCombo = [];                      // ç¾åœ¨ã®ã‚³ãƒ³ãƒœçŠ¶æ…‹
        let comboMessage = '';                      // ã‚³ãƒ³ãƒœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        let comboMessageTimer = 0;                  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ™‚é–“
        let glowTimer = 0;                          // ã‚·ãƒ£ãƒ¼ãƒ¬ã®å…‰ã‚‹æ¼”å‡ºã‚¿ã‚¤ãƒãƒ¼
        
        // ãƒ‘ãƒ¼ãƒ„ã®ç¨®é¡å®šç¾©
        const partTypes = {
            P: { name: 'Promoter', color: [255, 50, 50], shape: 'square', points: 10 },
            R: { name: 'RBS', color: [255, 200, 0], shape: 'circle', points: 10 },
            G: { name: 'Gene/GFP', color: [50, 255, 100], shape: 'capsule', points: 30 },
            T: { name: 'Terminator', color: [50, 100, 255], shape: 'tshape', points: 10 },
            X: { name: 'Antibiotics', color: [138, 43, 226], shape: 'spike', points: -50 }
        };
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¯ãƒ©ã‚¹ï¼ˆã‚·ãƒ£ãƒ¼ãƒ¬ï¼‰
        class Player {
            constructor() {
                this.width = 100;
                this.height = 20;
                this.x = 600;  // ä¸­å¤®ã«é…ç½®
                this.y = 550;
                this.speed = 8;
                this.gameAreaLeft = 200;   // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã®å·¦ç«¯
                this.gameAreaRight = 1000; // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã®å³ç«¯
            }
            
            // æç”»
            draw() {
                push();
                translate(this.x, this.y);
                
                // å…‰ã‚‹æ¼”å‡º
                if (glowTimer > 0) {
                    fill(100, 255, 100, 150);
                    noStroke();
                    ellipse(0, 0, this.width + 30, this.height + 30);
                }
                
                // ã‚·ãƒ£ãƒ¼ãƒ¬æœ¬ä½“
                fill(200, 220, 255);
                stroke(100, 140, 200);
                strokeWeight(3);
                
                // ã‚·ãƒ£ãƒ¼ãƒ¬ã®å½¢ï¼ˆæ¥•å††å½¢ï¼‰
                ellipse(0, 0, this.width, this.height);
                
                // ã‚·ãƒ£ãƒ¼ãƒ¬ã®è“‹ï¼ˆä¸Šéƒ¨ã®ç·šï¼‰
                stroke(80, 120, 180);
                line(-this.width/2 + 10, 0, this.width/2 - 10, 0);
                
                pop();
            }
            
            // ç§»å‹•å‡¦ç†
            update() {
                // ãƒã‚¦ã‚¹ã§ã®æ“ä½œï¼ˆã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ã®ã¿ï¼‰
                if (mouseX > this.gameAreaLeft && mouseX < this.gameAreaRight) {
                    this.x = mouseX;
                }
                
                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã®æ“ä½œ
                if (keyIsDown(LEFT_ARROW)) {
                    this.x -= this.speed;
                }
                if (keyIsDown(RIGHT_ARROW)) {
                    this.x += this.speed;
                }
                
                // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ã«åˆ¶é™
                this.x = constrain(this.x, this.gameAreaLeft + this.width/2, this.gameAreaRight - this.width/2);
            }
            
            // å½“ãŸã‚Šåˆ¤å®š
            checkCollision(part) {
                return (
                    part.x > this.x - this.width/2 &&
                    part.x < this.x + this.width/2 &&
                    part.y > this.y - this.height/2 &&
                    part.y < this.y + this.height/2
                );
            }
        }
        
        // è½ã¡ã¦ãã‚‹ãƒ‘ãƒ¼ãƒ„ã‚¯ãƒ©ã‚¹
        class FallingPart {
            constructor(type) {
                this.type = type;
                this.info = partTypes[type];
                this.x = random(250, 950);  // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ï¼ˆ200-1000pxï¼‰ã«åˆ¶é™
                this.y = -20;
                this.size = 30;
                this.speed = random(2, 4);
                this.rotation = 0;
            }
            
            // æç”»
            draw() {
                push();
                translate(this.x, this.y);
                rotate(this.rotation);
                
                fill(this.info.color);
                stroke(0);
                strokeWeight(2);
                
                // å½¢çŠ¶ã«å¿œã˜ã¦æç”»
                switch(this.info.shape) {
                    case 'square':
                        rect(-this.size/2, -this.size/2, this.size, this.size);
                        break;
                    case 'circle':
                        ellipse(0, 0, this.size, this.size);
                        break;
                    case 'capsule':
                        // ã‚«ãƒ—ã‚»ãƒ«å‹
                        rect(-this.size/2, -this.size/3, this.size, this.size/1.5, 15);
                        break;
                    case 'tshape':
                        // Tå­—å‹
                        rect(-this.size/2, -this.size/4, this.size, this.size/4);
                        rect(-this.size/6, -this.size/4, this.size/3, this.size);
                        break;
                    case 'spike':
                        // ãƒˆã‚²ãƒˆã‚²
                        for (let i = 0; i < 8; i++) {
                            let angle = (TWO_PI / 8) * i;
                            let x1 = cos(angle) * this.size/4;
                            let y1 = sin(angle) * this.size/4;
                            let x2 = cos(angle) * this.size/2;
                            let y2 = sin(angle) * this.size/2;
                            triangle(0, 0, x1, y1, x2, y2);
                        }
                        break;
                }
                
                // ãƒ‘ãƒ¼ãƒ„ã®ãƒ©ãƒ™ãƒ«
                fill(255);
                noStroke();
                textAlign(CENTER, CENTER);
                textSize(14);
                textStyle(BOLD);
                text(this.type, 0, 0);
                
                pop();
            }
            
            // æ›´æ–°
            update() {
                this.y += this.speed;
                this.rotation += 0.05;
            }
            
            // ç”»é¢å¤–ã«å‡ºãŸã‹åˆ¤å®š
            isOffScreen() {
                return this.y > height + 50;
            }
        }
        
        // p5.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setup() {
            let canvas = createCanvas(1200, 600);
            canvas.parent('canvas-container');
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæœŸåŒ–
            player = new Player();
            
            // ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
            startTime = millis();
            
            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®èª­ã¿è¾¼ã¿
            loadRankings();
        }
        
        // p5.js ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
        function draw() {
            // èƒŒæ™¯
            background(20, 25, 40);
            
            // ã‚¨ãƒªã‚¢ã®åŒºåˆ‡ã‚Šç·š
            stroke(100, 100, 150);
            strokeWeight(2);
            line(200, 0, 200, height);  // å·¦å´ã®åŒºåˆ‡ã‚Šç·š
            line(1000, 0, 1000, height); // å³å´ã®åŒºåˆ‡ã‚Šç·š
            
            // ã‚²ãƒ¼ãƒ çµ‚äº†ã—ã¦ã„ãªã„å ´åˆ
            if (!gameOver) {
                // æ®‹ã‚Šæ™‚é–“ã®è¨ˆç®—
                timeLeft = gameTime - floor((millis() - startTime) / 1000);
                
                if (timeLeft <= 0) {
                    timeLeft = 0;
                    gameOver = true;
                    
                    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¿½åŠ ï¼ˆ1å›ã ã‘ï¼‰
                    if (!rankingSaved) {
                        saveRanking(score);
                        rankingSaved = true;
                    }
                }
                
                // ãƒ‘ãƒ¼ãƒ„ã®å‡ºç¾
                frameCounter++;
                if (frameCounter >= spawnInterval) {
                    frameCounter = 0;
                    let types = ['P', 'R', 'G', 'T', 'X'];
                    let randomType = random(types);
                    fallingParts.push(new FallingPart(randomType));
                }
                
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ›´æ–°ã¨æç”»
                player.update();
                player.draw();
                
                // è½ã¡ã¦ãã‚‹ãƒ‘ãƒ¼ãƒ„ã®æ›´æ–°ã¨æç”»
                for (let i = fallingParts.length - 1; i >= 0; i--) {
                    let part = fallingParts[i];
                    part.update();
                    part.draw();
                    
                    // å½“ãŸã‚Šåˆ¤å®š
                    if (player.checkCollision(part)) {
                        handleCatch(part);
                        fallingParts.splice(i, 1);
                    }
                    // ç”»é¢å¤–ã«å‡ºãŸã‚‰å‰Šé™¤
                    else if (part.isOffScreen()) {
                        fallingParts.splice(i, 1);
                    }
                }
                
                // å…‰ã‚‹æ¼”å‡ºã®ã‚¿ã‚¤ãƒãƒ¼æ¸›å°‘
                if (glowTimer > 0) {
                    glowTimer--;
                }
                
                // ã‚³ãƒ³ãƒœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒãƒ¼æ¸›å°‘
                if (comboMessageTimer > 0) {
                    comboMessageTimer--;
                }
                
                // UIè¡¨ç¤º
                drawUI();
                
                // å¾—ç‚¹è¡¨è¡¨ç¤º
                drawScoreTable();
                
                // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
                drawRankings();
                
                // ã‚³ãƒ³ãƒœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
                if (comboMessageTimer > 0) {
                    push();
                    textAlign(CENTER, CENTER);
                    textSize(48);
                    fill(100, 255, 100);
                    stroke(255);
                    strokeWeight(4);
                    text(comboMessage, width/2, height/2);
                    pop();
                }
            } else {
                // ã‚²ãƒ¼ãƒ çµ‚äº†ç”»é¢
                drawGameOver();
            }
        }
        
        // ãƒ‘ãƒ¼ãƒ„ã‚’ã‚­ãƒ£ãƒƒãƒã—ãŸã¨ãã®å‡¦ç†
        function handleCatch(part) {
            // ã‚¹ã‚³ã‚¢åŠ ç®—
            score += part.info.points;
            
            // Antibioticsä»¥å¤–ã®å ´åˆã€ã‚³ãƒ³ãƒœãƒã‚§ãƒƒã‚¯
            if (part.type !== 'X') {
                // æ¬¡ã«æ‹¾ã†ã¹ããƒ‘ãƒ¼ãƒ„ã¨ä¸€è‡´ã™ã‚‹ã‹ç¢ºèª
                let expectedPart = comboSequence[currentCombo.length];
                
                if (part.type === expectedPart) {
                    currentCombo.push(part.type);
                    
                    // ã‚³ãƒ³ãƒœå®Œæˆãƒã‚§ãƒƒã‚¯
                    if (currentCombo.length === comboSequence.length) {
                        score += 200;  // ãƒœãƒ¼ãƒŠã‚¹
                        comboMessage = 'Circuit Complete!';
                        comboMessageTimer = 120;  // 2ç§’é–“è¡¨ç¤º
                        glowTimer = 30;  // 0.5ç§’é–“å…‰ã‚‹
                        currentCombo = [];  // ã‚³ãƒ³ãƒœãƒªã‚»ãƒƒãƒˆ
                    }
                } else {
                    // é †ç•ªãŒé•ã†å ´åˆã¯ã‚³ãƒ³ãƒœãƒªã‚»ãƒƒãƒˆ
                    currentCombo = [];
                    // ãŸã ã—ã€ãã®ãƒ‘ãƒ¼ãƒ„ãŒã‚³ãƒ³ãƒœã®æœ€åˆã®ãƒ‘ãƒ¼ãƒ„ãªã‚‰é–‹å§‹
                    if (part.type === comboSequence[0]) {
                        currentCombo.push(part.type);
                    }
                }
            } else {
                // Antibioticsã‚’æ‹¾ã£ãŸã‚‰ã‚³ãƒ³ãƒœãƒªã‚»ãƒƒãƒˆ
                currentCombo = [];
            }
        }
        
        // UIè¡¨ç¤º
        function drawUI() {
            push();
            
            // èƒŒæ™¯ãƒ‘ãƒãƒ«ï¼ˆã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã®ã¿ï¼‰
            fill(0, 0, 0, 150);
            noStroke();
            rect(200, 0, 800, 80);
            
            // ã‚¹ã‚³ã‚¢è¡¨ç¤º
            fill(255);
            textSize(24);
            textAlign(LEFT, TOP);
            text('ã‚¹ã‚³ã‚¢: ' + score, 220, 15);
            
            // æ®‹ã‚Šæ™‚é–“è¡¨ç¤º
            textAlign(RIGHT, TOP);
            fill(timeLeft <= 10 ? color(255, 100, 100) : color(255));
            text('æ®‹ã‚Šæ™‚é–“: ' + timeLeft + 'ç§’', 980, 15);
            
            // æ¬¡ã«æ‹¾ã†ã¹ããƒ‘ãƒ¼ãƒ„ã®ãƒ’ãƒ³ãƒˆ
            textAlign(LEFT, TOP);
            textSize(18);
            fill(200, 255, 200);
            text('ã‚³ãƒ³ãƒœãƒ’ãƒ³ãƒˆ:', 220, 50);
            
            let hintX = 350;
            for (let i = 0; i < comboSequence.length; i++) {
                let partType = comboSequence[i];
                let partInfo = partTypes[partType];
                
                // æ—¢ã«æ‹¾ã£ãŸãƒ‘ãƒ¼ãƒ„ã¯æ˜ã‚‹ãè¡¨ç¤º
                if (i < currentCombo.length) {
                    fill(partInfo.color);
                    stroke(255);
                    strokeWeight(3);
                } else if (i === currentCombo.length) {
                    // æ¬¡ã«æ‹¾ã†ã¹ããƒ‘ãƒ¼ãƒ„ã‚’å¼·èª¿
                    fill(partInfo.color);
                    stroke(255, 255, 0);
                    strokeWeight(3);
                } else {
                    // ã¾ã æ‹¾ã£ã¦ã„ãªã„ãƒ‘ãƒ¼ãƒ„ã¯è–„ãè¡¨ç¤º
                    fill(partInfo.color[0], partInfo.color[1], partInfo.color[2], 100);
                    stroke(150);
                    strokeWeight(1);
                }
                
                rect(hintX, 45, 30, 30, 5);
                
                fill(255);
                noStroke();
                textAlign(CENTER, CENTER);
                textSize(16);
                text(partType, hintX + 15, 60);
                
                hintX += 40;
                
                // çŸ¢å°ã‚’è¡¨ç¤º
                if (i < comboSequence.length - 1) {
                    fill(150);
                    textSize(20);
                    text('â†’', hintX - 20, 60);
                }
            }
            
            pop();
        }
        
        // ã‚²ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            score = 0;
            timeLeft = gameTime;
            gameOver = false;
            rankingSaved = false;
            fallingParts = [];
            currentCombo = [];
            comboMessage = '';
            comboMessageTimer = 0;
            glowTimer = 0;
            frameCounter = 0;
            player = new Player();
            startTime = millis();
        }
        
        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢
        function drawGameOver() {
            background(20, 25, 40);
            
            // å¾—ç‚¹è¡¨è¡¨ç¤º
            drawScoreTable();
            
            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
            drawRankings();
            
            push();
            textAlign(CENTER, CENTER);
            
            // ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆç”»é¢ä¸­å¤®ï¼‰
            fill(255, 200, 100);
            textSize(48);
            textStyle(BOLD);
            text('ã‚²ãƒ¼ãƒ çµ‚äº†ï¼', 600, height/2 - 100);
            
            // æœ€çµ‚ã‚¹ã‚³ã‚¢
            fill(100, 255, 150);
            textSize(64);
            text('Total Score: ' + score, 600, height/2);
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            fill(200);
            textSize(24);
            textStyle(NORMAL);
            text('ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼', 600, height/2 + 80);
            
            // ã‚‚ã†ä¸€åº¦éŠã¶ãƒœã‚¿ãƒ³
            let buttonX = 600;
            let buttonY = height/2 + 140;
            let buttonW = 200;
            let buttonH = 50;
            
            // ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼åˆ¤å®š
            let isHover = mouseX > buttonX - buttonW/2 && mouseX < buttonX + buttonW/2 &&
                          mouseY > buttonY - buttonH/2 && mouseY < buttonY + buttonH/2;
            
            // ãƒœã‚¿ãƒ³ã®æç”»
            if (isHover) {
                fill(100, 255, 150);
                cursor(HAND);
            } else {
                fill(50, 200, 100);
                cursor(ARROW);
            }
            stroke(255);
            strokeWeight(3);
            rect(buttonX - buttonW/2, buttonY - buttonH/2, buttonW, buttonH, 10);
            
            fill(255);
            noStroke();
            textSize(24);
            textStyle(BOLD);
            text('ã‚‚ã†ä¸€åº¦éŠã¶', buttonX, buttonY);
            
            pop();
        }
        
        // å¾—ç‚¹è¡¨ã®è¡¨ç¤º
        function drawScoreTable() {
            push();
            
            // å¾—ç‚¹è¡¨ãƒ‘ãƒãƒ«ã®èƒŒæ™¯
            fill(0, 0, 0, 180);
            noStroke();
            rect(20, 100, 160, 380, 10);
            
            // ã‚¿ã‚¤ãƒˆãƒ«
            fill(100, 200, 255);
            textSize(20);
            textStyle(BOLD);
            textAlign(CENTER, TOP);
            text('ğŸ“Š å¾—ç‚¹è¡¨ ğŸ“Š', 100, 110);
            
            // å„ãƒ‘ãƒ¼ãƒ„ã®å¾—ç‚¹è¡¨ç¤º
            textAlign(LEFT, TOP);
            textStyle(NORMAL);
            let yPos = 150;
            
            // Promoter
            fill(partTypes.P.color);
            rect(35, yPos, 25, 25, 3);
            fill(255);
            textSize(14);
            text('P', 42, yPos + 5);
            fill(200);
            textSize(12);
            text('Promoter', 70, yPos + 2);
            fill(255, 200, 100);
            textSize(16);
            text('+10', 70, yPos + 16);
            yPos += 45;
            
            // RBS
            fill(partTypes.R.color);
            ellipse(47, yPos + 12, 25, 25);
            fill(255);
            textSize(14);
            text('R', 42, yPos + 5);
            fill(200);
            textSize(12);
            text('RBS', 70, yPos + 2);
            fill(255, 200, 100);
            textSize(16);
            text('+10', 70, yPos + 16);
            yPos += 45;
            
            // Gene/GFP
            fill(partTypes.G.color);
            rect(35, yPos + 4, 25, 18, 8);
            fill(255);
            textSize(14);
            text('G', 41, yPos + 5);
            fill(200);
            textSize(12);
            text('Gene/GFP', 70, yPos + 2);
            fill(255, 200, 100);
            textSize(16);
            text('+30', 70, yPos + 16);
            yPos += 45;
            
            // Terminator
            fill(partTypes.T.color);
            rect(35, yPos + 8, 25, 4);
            rect(44, yPos + 8, 7, 18);
            fill(255);
            textSize(14);
            text('T', 43, yPos + 8);
            fill(200);
            textSize(12);
            text('Terminator', 70, yPos + 2);
            fill(255, 200, 100);
            textSize(16);
            text('+10', 70, yPos + 16);
            yPos += 45;
            
            // Antibiotics
            fill(partTypes.X.color);
            for (let i = 0; i < 8; i++) {
                let angle = (TWO_PI / 8) * i;
                let x1 = 47 + cos(angle) * 4;
                let y1 = yPos + 12 + sin(angle) * 4;
                let x2 = 47 + cos(angle) * 12;
                let y2 = yPos + 12 + sin(angle) * 12;
                triangle(47, yPos + 12, x1, y1, x2, y2);
            }
            fill(255);
            textSize(14);
            text('X', 42, yPos + 5);
            fill(200);
            textSize(12);
            text('Antibiotics', 70, yPos + 2);
            fill(255, 100, 100);
            textSize(16);
            text('-50', 70, yPos + 16);
            yPos += 55;
            
            // ã‚³ãƒ³ãƒœãƒœãƒ¼ãƒŠã‚¹
            fill(255, 215, 0);
            textSize(16);
            textStyle(BOLD);
            textAlign(CENTER, TOP);
            text('âš¡ ã‚³ãƒ³ãƒœãƒœãƒ¼ãƒŠã‚¹ âš¡', 100, yPos + 8);
            
            fill(200);
            textSize(12);
            textStyle(NORMAL);
            text('P â†’ R â†’ G â†’ T', 100, yPos + 30);
            
            fill(100, 255, 100);
            textSize(20);
            textStyle(BOLD);
            text('+200', 100, yPos + 46);
            
            pop();
        }
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®èª­ã¿è¾¼ã¿
        function loadRankings() {
            let saved = localStorage.getItem('biobricks-rankings');
            if (saved) {
                rankings = JSON.parse(saved);
            } else {
                rankings = [];
            }
        }
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ä¿å­˜
        function saveRanking(newScore) {
            rankings.push(newScore);
            rankings.sort((a, b) => b - a);  // é™é †ã«ã‚½ãƒ¼ãƒˆ
            rankings = rankings.slice(0, 3);  // ãƒˆãƒƒãƒ—3ã®ã¿ä¿æŒ
            localStorage.setItem('biobricks-rankings', JSON.stringify(rankings));
        }
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®è¡¨ç¤º
        function drawRankings() {
            push();
            
            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‘ãƒãƒ«ã®èƒŒæ™¯
            fill(0, 0, 0, 180);
            noStroke();
            rect(1020, 100, 160, 200, 10);
            
            // ã‚¿ã‚¤ãƒˆãƒ«
            fill(255, 215, 0);
            textSize(20);
            textStyle(BOLD);
            textAlign(CENTER, TOP);
            text('ğŸ† TOP 3 ğŸ†', 1100, 110);
            
            // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
            textAlign(LEFT, TOP);
            textStyle(NORMAL);
            let yPos = 150;
            
            for (let i = 0; i < 3; i++) {
                // é †ä½ã®è‰²
                let rankColor;
                if (i === 0) rankColor = color(255, 215, 0);      // é‡‘è‰²
                else if (i === 1) rankColor = color(192, 192, 192); // éŠ€è‰²
                else rankColor = color(205, 127, 50);              // éŠ…è‰²
                
                // é †ä½è¡¨ç¤º
                fill(rankColor);
                textSize(18);
                text((i + 1) + 'ä½', 1035, yPos);
                
                // ã‚¹ã‚³ã‚¢è¡¨ç¤º
                fill(255);
                textSize(24);
                if (i < rankings.length) {
                    text(rankings[i], 1080, yPos - 2);
                } else {
                    fill(100);
                    text('---', 1080, yPos - 2);
                }
                
                yPos += 50;
            }
            
            pop();
        }
        
        // ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
        function mousePressed() {
            if (gameOver) {
                // ãƒœã‚¿ãƒ³ã®ä½ç½®ã¨ã‚µã‚¤ã‚º
                let buttonX = 600;
                let buttonY = height/2 + 140;
                let buttonW = 200;
                let buttonH = 50;
                
                // ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‹åˆ¤å®š
                if (mouseX > buttonX - buttonW/2 && mouseX < buttonX + buttonW/2 &&
                    mouseY > buttonY - buttonH/2 && mouseY < buttonY + buttonH/2) {
                    resetGame();
                }
            }
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ï¼‰
        function windowResized() {
            // å°ã•ã„ç”»é¢ã§ã¯ç¸®å°è¡¨ç¤º
            let canvasWidth = min(windowWidth - 20, 1200);
            let canvasHeight = (canvasWidth / 1200) * 600;
            resizeCanvas(canvasWidth, canvasHeight);
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®ã®èª¿æ•´
            if (player) {
                player.x = constrain(player.x, player.width/2, width - player.width/2);
                player.y = height - 50;
            }
        }
    </script>
</body>
</html>